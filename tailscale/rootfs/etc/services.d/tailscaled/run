#!/command/with-contenv bashio
# ==============================================================================
# Home Assistant Add-on: Tailscale
# Runs tailscale
# ==============================================================================
declare -a options
declare executable

bashio::log.info 'Starting Tailscale...'

options+=(--state=/data/tailscaled.state)
options+=(--statedir=/data/)
options+=(--no-logs-no-support)
options+=(--tun=userspace-networking)

# Trigger post process to run, after stuff got connected
./post &

if bashio::config.true "run_unstable" ; then
    executable=tailscaled_beta
else
    executable=tailscaled
fi


# Run Tailscale
exec ${executable} "${options[@]}" &> /dev/null
